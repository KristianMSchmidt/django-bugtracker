{% load static %}
<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>{% block title %}Bugtracker{% endblock title%} | BugTracker</title>
        
        <!-- CSS -->
        <link rel="stylesheet" href="{% static 'css/base.css' %}">
        <script src="https://kit.fontawesome.com/114f0c3f98.js" crossorigin="anonymous"></script>

        <link href="{% static "css/bootstrap.min.css" %}" rel="stylesheet" />

    </head>

    <body>
    

     <!-- Navigation -->
     <nav class="navbar navbar-expand navbar-dark bg-dark static-top">
         <div class="container-fluid">
             <a class="navbar-brand" href="#!">Bug Tracker</a>
             <div class="collapse navbar-collapse" id="navbarResponsive">
                
                 <ul class="navbar-nav ml-auto">
            
                     {% if user.is_authenticated %}
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" role="button"
                                data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <i class="far fa-bell"></i>
                            </a>
                            <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdownMenuLink">
                                <a class="dropdown-item" href="#">Signed in as <b>{{ user.username }}</b></a>
                                <div class="dropdown-divider"></div>
                                <a class="dropdown-item" href="{% url 'project_list' %}">Your projects</a>
                                <a class="dropdown-item" href="{% url 'ticket_list' %}">Your Tickets</a>
                                <div class="dropdown-divider"></div>
                                <a class="dropdown-item" href="{% url 'logout' %}">Sign out</a>
                            </div>
                        </li>
                        <li class="nav-item dropdown pr-2">
                            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" role="button"
                                data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <i class="far fa-user"></i>
                            </a>
                            <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdownMenuLink">
                                <a class="dropdown-item" href="#">Signed in as <b>{{ user.username }}</b></a>
                                <div class="dropdown-divider"></div>
                                <a class="dropdown-item" href="{% url 'project_list' %}">Your projects</a>
                                <a class="dropdown-item" href="{% url 'ticket_list' %}">Your Tickets</a>
                                <div class="dropdown-divider"></div>
                                <a class="dropdown-item" href="{% url 'logout' %}">Sign out</a>
                            </div>
                        </li>
                     {% endif %}

                 </ul>
             </div>
         </div>
     </nav>
<ul class="nav nav-tabs">
    <li class="nav-item">
        <a class="nav-link active" aria-current="page" href="#">Dashboard</a>
    </li>
    <li class="nav-item">
        <a class="nav-link" href="#">My Projects</a>
    </li>
    <li class="nav-item">
        <a class="nav-link" href="#">My Tickets</a>
    </li>
    <li class="nav-item">
        <a class="nav-link" href="#">Manage Project Users</a>
    </li>
    <li class="nav-item">
        <a class="nav-link" href="#">Manage User Roles</a>
    </li>

</ul>

<nav class="nav flex-row">
    <a class="nav-link active" aria-current="page" href="#">Active</a>
    <a class="nav-link" href="#">Link</a>
    <a class="nav-link" href="#">Link</a>
    <a class="nav-link disabled" href="#" tabindex="-1" aria-disabled="true">Disabled</a>
</nav>

<br><br><br><br>
        <div>
            {% if user.is_authenticated %}
                Hi {{ user.username }}!. Your email is {{ user.email }}. Your role is {{ user.get_role_display }}. <br>

                <a href="{% url 'dashboard' %}">Dashboard</a>
                <a href="{% url 'about' %}">About</a>
               
            {% else %}
                <p>You are not logged in</p>
                <a href="{% url 'login' %}">Log In</a>
                <a href="{% url 'signup' %}">Sign Up</a>
            {% endif %}
        </div>
        <ul>
         <li><a href="{% url 'admin:index' %}">Admin Area</a></li>
        </ul>
        
        <h2>Notifications</h2>
        <table>
            <tr>
                <th>sender - not correct</th>
                <th>recipient</th>
                <th>created_at</th>
                <th>type</th>
                <th>type display</th>
                <th>unseen</th>
                <th>text</th>
                <th>link</th>
            </tr>
            
            {% for ntf in notifications %}
            <tr>
                <td>{{ ntf.sender }}</td>
                <td>{{ ntf.recipient }}</td>
                <td>{{ ntf.created_at }}</td>
                <td>{{ ntf.type }}</td>
                <td>{{ ntf.get_type_display }}</td>
                <td>{{ ntf.unseen }}</td>
                
                {% if ntf.type == 1 %} 
                    <!-- role change -->
                    <td>{{ ntf.get_new_role_display }}</td>
                    <td><a href="{% url 'profile' %}">Profile</a></td>

                {% elif ntf.type == 2 %}
                    <!-- ticket assignment-->
                    <td> {{ ntf.ticket.title }} </td>
                    <td><a href="{% url 'ticket_detail' ntf.ticket.pk %}">Ticket</a></td>
                
                {% elif ntf.type == 3 %}
                    <!-- ticket un-assignment-->
                    <td> {{ ntf.ticket.title }} </td>
                    <td><a href="{% url 'ticket_detail' ntf.ticket.pk %}">Ticket</a></td>

                {% elif ntf.type == 4 %}
                    <!-- project enrollment-->
                    <td> {{ ntf.project.title }} </td>
                    <td><a href="{% url 'project_detail' ntf.project.pk %}">Project</a></td>

                {% elif ntf.type == 5 %}
                     <!-- project dis-enrollment-->
                     <td> {{ ntf.project.title }} </td>
                     <td><a href="{% url 'project_detail' ntf.project.pk %}">Project</a></td>

                {% elif ntf.type == 6 %}
                    <!-- New ticket comment -->
                    <td> {{ ntf.ticket.title }} </td>
                    <td><a href="{% url 'ticket_detail' ntf.ticket.pk %}">Ticket</a></td>

                {% endif %}
            </tr>
            {% endfor %}
        </table>
        
        <main>
            <!-- Potential messages -->
            {% if messages %}
                {% for message in messages %}
                    {% if 'success' in message.tags %}
                        <div class="bg-green-200 text-green-800 px-4 py-2 mb-2">
                            {{message}}
                        </div>
                    {% else %}
                        <div class="bg-red-200 text-red-800 px-4 py-2 mb-2">
                            {{message}}
                        </div>
                    {% endif %}
                {% endfor %}
            {% endif %}

            <!-- Page Content-->
            {% block content %}
            {% endblock content %}
        </main>

        <!-- Bootstrap core JS-->
        <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/js-cookie@rc/dist/js.cookie.min.js"></script>

        <!-- Core theme JS-->
        <script src="{% static 'js/base.js' %}"></script>
        {% block javascript %}
        {% endblock javascript %}

    </body>

</html>